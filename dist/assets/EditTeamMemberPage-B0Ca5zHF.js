import{r as h,M as H,t as K,j as e,B as t,L as a,I as n,S as j,f,g as N,h as w,i,D as v,a as D,b as k,d as _,e as S}from"./index-B8PRHD2z.js";import{C as J}from"./checkbox-kT0Z1nYk.js";import{c as W,a as X,d as Y,e as Z}from"./useUsers-PdwlX9GH.js";import{a as ee,U as se}from"./useUploadFile-D_U9fZyB.js";import{T as oe}from"./trash-2-B4xNHU9E.js";import{U as le}from"./user-BPrg1Uey.js";function ie({teamMember:d,onBack:U,onSave:u}){const[o,T]=h.useState({...d,email:d.email||"",dob:d.dob||""}),[E,x]=h.useState(!1),[O,m]=h.useState(!1),[I,b]=h.useState(!1),{data:B}=H(),R=K(),q=W(),L=X(),p=Y(),A=Z(),z=ee(),V=B?B.map(s=>s.name):[],r=(s,l)=>{T(c=>({...c,[s]:l}))},M=s=>{s.preventDefault(),console.log(o),o.id&&o.id!=0?L.mutate({id:o.id,data:o},{onSuccess:()=>u(o)}):(console.log("creating"),q.mutate(o,{onSuccess:l=>{var c;console.log("✅ User created:",l),console.log("sending photo"),(c=l==null?void 0:l.user)!=null&&c.id&&F(l.id),u(l)},onError:l=>{console.error("❌ Error creating user:",l)},onSettled:()=>{console.log("ℹ️ createUser.mutate finished (success or error)")}})),u(o)},Q=()=>{o.id&&o.id!==0&&A.mutate(o.id,{onSuccess:()=>{console.log("Successfully password rest of team member:"),b(!0)},onError:s=>{console.error("Error deleting team member:",s)}}),console.log("Password reset requested for:",o.first_name)},$=()=>{o.id&&o.id!==0&&p.mutate(o.id,{onSuccess:s=>{console.log("Successfully deleted team member:",s),m(!1),U()},onError:s=>{console.error("Error deleting team member:",s)}})},F=s=>{const l=document.createElement("input");l.type="file",l.accept="image/*",l.style.display="none",l.onchange=c=>{var P;const C=(P=c.target.files)==null?void 0:P[0];if(C){s!=0&&z.mutate({userId:s,file:C},{onSuccess:y=>{console.log("Uploaded:",y),x(!0),R.invalidateQueries({queryKey:["users"]})},onError:y=>{console.error("Upload failed",y)}});const G=URL.createObjectURL(C);r("photo",G),console.log("Photo uploaded:",C.name)}},document.body.appendChild(l),l.click(),document.body.removeChild(l)},g=!d.first_name||d.id===Date.now()||d.first_name==="";return e.jsx("div",{className:"flex-1 px-6 py-8",style:{backgroundColor:"#F8F9FA"},children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"bg-white px-4 py-2 border",style:{borderColor:"#e65039"},children:e.jsx("h2",{className:"text-lg font-bold",style:{color:"#3C3C3C"},children:g?"Add New Team member / CT":"Edit Team member / CT"})}),e.jsx(t,{onClick:U,className:"px-6 py-2 rounded-lg transition-all duration-200 hover:opacity-90",style:{backgroundColor:"#e65039",color:"white",border:"none"},children:"Back"})]}),e.jsx("div",{className:"bg-white p-8 rounded-lg shadow-sm",children:e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"first_name",className:"block mb-2",style:{color:"#3C3C3C"},children:"First Name"}),e.jsx(n,{id:"first_name",type:"text",value:o.first_name,onChange:s=>r("first_name",s.target.value),className:"w-full border-2 px-3 py-2 rounded-none",style:{borderColor:"#BDC3C7"},required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"last_name",className:"block mb-2",style:{color:"#3C3C3C"},children:"Last Name"}),e.jsx(n,{id:"last_name",type:"text",value:o.last_name,onChange:s=>r("last_name",s.target.value),className:"w-full border-2 px-3 py-2 rounded-none",style:{borderColor:"#BDC3C7"},required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"id_number",className:"block mb-2",style:{color:"#3C3C3C"},children:"ID Number"}),e.jsx(n,{id:"id_number",type:"text",value:o.id_number,onChange:s=>r("id_number",s.target.value),className:"w-full border-2 px-3 py-2 rounded-none",style:{borderColor:"#BDC3C7"},required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"dob",className:"block mb-2",style:{color:"#3C3C3C"},children:"DOB"}),e.jsx(n,{id:"dob",type:"date",value:o.dob,onChange:s=>r("dob",s.target.value),className:"w-full border-2 px-3 py-2 rounded-none",style:{borderColor:"#BDC3C7"},placeholder:"dd/mm/yyyy"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"specialization",className:"block mb-2",style:{color:"#3C3C3C"},children:"Specialisation"}),e.jsx(n,{id:"specialization",type:"text",value:o.specialization,onChange:s=>r("specialization",s.target.value),className:"w-full border-2 px-3 py-2 rounded-none",style:{borderColor:"#BDC3C7"}})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"email",className:"block mb-2",style:{color:"#3C3C3C"},children:"Email"}),e.jsx(n,{id:"email",type:"email",value:o.email,onChange:s=>r("email",s.target.value),className:"w-full border-2 px-3 py-2 rounded-none",style:{borderColor:"#BDC3C7"}})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"role",className:"block mb-2",style:{color:"#3C3C3C"},children:"Role"}),e.jsxs(j,{value:o.role,onValueChange:s=>r("role",s),children:[e.jsx(f,{className:"w-full border-2 rounded-none",style:{borderColor:"#BDC3C7"},children:e.jsx(N,{placeholder:"Team member"})}),e.jsxs(w,{className:"bg-white border border-gray-200 shadow-lg rounded-md",style:{backgroundColor:"white",borderColor:"#BDC3C7",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},children:[e.jsx(i,{value:"teacher",className:"hover:bg-gray-100 focus:bg-gray-100",style:{color:"#3C3C3C"},children:"Team member"}),e.jsx(i,{value:"ct",className:"hover:bg-gray-100 focus:bg-gray-100",style:{color:"#3C3C3C"},children:"CT"})]})]})]}),(o.role==="teacher"||o.role==="ct")&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{id:"is_ct",checked:o.is_ct?o.is_ct:!1,onCheckedChange:s=>r("is_ct",s),disabled:o.role==="ct"}),e.jsx(a,{htmlFor:"is_ct",className:"text-sm text-gray-700",children:"Also CT"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"gender",className:"block mb-2",style:{color:"#3C3C3C"},children:"Gender"}),e.jsxs(j,{value:o.gender,onValueChange:s=>r("gender",s),children:[e.jsx(f,{className:"w-full border-2 rounded-none",style:{borderColor:"#BDC3C7"},children:e.jsx(N,{placeholder:"Select gender"})}),e.jsxs(w,{className:"bg-white border border-gray-200 shadow-lg rounded-md",style:{backgroundColor:"white",borderColor:"#BDC3C7",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},children:[e.jsx(i,{value:"Male",className:"hover:bg-gray-100 focus:bg-gray-100",style:{color:"#3C3C3C"},children:"Male"}),e.jsx(i,{value:"Female",className:"hover:bg-gray-100 focus:bg-gray-100",style:{color:"#3C3C3C"},children:"Female"}),e.jsx(i,{value:"Other",className:"hover:bg-gray-100 focus:bg-gray-100",style:{color:"#3C3C3C"},children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"class",className:"block mb-2",style:{color:"#3C3C3C"},children:"Classes"}),e.jsxs(j,{value:o.classes,onValueChange:s=>r("classes",s),children:[e.jsx(f,{className:"w-full border-2 rounded-none",style:{borderColor:"#BDC3C7"},children:e.jsx(N,{placeholder:"Select class"})}),e.jsx(w,{className:"bg-white border border-gray-200 shadow-lg rounded-md",style:{backgroundColor:"white",borderColor:"#BDC3C7",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},children:V.map(s=>e.jsx(i,{value:s,className:"hover:bg-gray-100 focus:bg-gray-100",style:{color:"#3C3C3C"},children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"date_of_joining",className:"block mb-2",style:{color:"#3C3C3C"},children:"Date of joining"}),e.jsx(n,{id:"date_of_joining",type:"date",value:o.date_of_joining,onChange:s=>r("date_of_joining",s.target.value),className:"w-full border-2 px-3 py-2 rounded-none",style:{borderColor:"#BDC3C7"}})]}),!g&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(t,{type:"button",onClick:()=>m(!0),className:"px-6 py-2 font-medium transition-all duration-200 hover:opacity-90 flex items-center space-x-2",style:{backgroundColor:"#DC3545",color:"white",borderColor:"#DC3545"},children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Delete Team Member"})]})})]})]}),e.jsxs("div",{className:"flex flex-col items-center space-y-4 py-6",children:[e.jsxs("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center overflow-hidden border-2",style:{borderColor:"#BDC3C7"},children:[o.photo?e.jsx("img",{src:o.photo,alt:`${o.first_name}'s photo`,className:"w-full h-full object-cover",onError:s=>{var l;s.target.style.display="none",(l=s.target.nextElementSibling)==null||l.classList.remove("hidden")}}):null,e.jsx(le,{className:`w-8 h-8 ${o.photo?"hidden":""}`,style:{color:"#BDC3C7"}})]}),e.jsxs("button",{type:"button",onClick:()=>F(o.id),className:"flex items-center space-x-2 px-4 py-2 border-2 rounded-lg transition-all duration-200 hover:bg-blue-50",style:{borderColor:"#e65039",color:"#e65039",backgroundColor:"white"},children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{children:"Change photo"})]})]}),e.jsxs("div",{className:"space-y-3 pt-4",children:[e.jsx(t,{type:"button",onClick:Q,className:"w-full border-2 px-4 py-3 rounded-none transition-all duration-200 hover:opacity-90",style:{backgroundColor:"white",borderColor:"#BDC3C7",color:"#3C3C3C"},children:"Reset Password"}),e.jsx(t,{type:"submit",className:"w-full px-4 py-3 rounded-none transition-all duration-200 hover:opacity-90",style:{backgroundColor:"#e65039",color:"white",border:"none"},children:g?"Create":"Update"})]}),e.jsx(v,{open:E,onOpenChange:x,children:e.jsxs(D,{className:"max-w-md bg-white rounded-lg border-2",style:{backgroundColor:"white",borderColor:"#BDC3C7"},children:[e.jsxs(k,{children:[e.jsx(_,{style:{color:"#3C3C3C"},children:"Photo Update"}),e.jsx(S,{style:{color:"#6C757D"},children:"Photo has been successfully updated."})]}),e.jsx("div",{className:"flex justify-end space-x-3 pt-2",children:e.jsx(t,{onClick:()=>x(!1),className:"px-4 py-2 border-2 transition-all duration-200",style:{backgroundColor:"white",borderColor:"#BDC3C7",color:"#3C3C3C"},children:"Ok"})})]})}),e.jsx(v,{open:I,onOpenChange:b,children:e.jsxs(D,{className:"max-w-md bg-white rounded-lg border-2",style:{backgroundColor:"white",borderColor:"#BDC3C7"},children:[e.jsxs(k,{children:[e.jsx(_,{style:{color:"#3C3C3C"},children:"Password Update"}),e.jsx(S,{style:{color:"#6C757D"},children:"Password has been reset succesfully."})]}),e.jsx("div",{className:"flex justify-end space-x-3 pt-2",children:e.jsx(t,{onClick:()=>b(!1),className:"px-4 py-2 border-2 transition-all duration-200",style:{backgroundColor:"white",borderColor:"#BDC3C7",color:"#3C3C3C"},children:"Ok"})})]})}),e.jsx(v,{open:O,onOpenChange:m,children:e.jsxs(D,{className:"max-w-md bg-white rounded-lg border-2",style:{backgroundColor:"white",borderColor:"#DC3545"},children:[e.jsxs(k,{children:[e.jsx(_,{style:{color:"#DC3545"},children:"Delete Team Member"}),e.jsxs(S,{style:{color:"#6C757D"},children:["Are you sure you want to delete ",o.first_name," ",o.last_name,"? This action cannot be undone."]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-2",children:[e.jsx(t,{onClick:()=>m(!1),className:"px-4 py-2 border-2 transition-all duration-200",style:{backgroundColor:"white",borderColor:"#BDC3C7",color:"#3C3C3C"},children:"Cancel"}),e.jsx(t,{onClick:$,disabled:p.isPending,className:"px-4 py-2 transition-all duration-200",style:{backgroundColor:"#DC3545",color:"white",borderColor:"#DC3545"},children:p.isPending?"Deleting...":"Delete"})]})]})}),e.jsx("div",{className:"mt-6 pt-4",children:e.jsx("div",{className:"bg-yellow-100 px-4 py-3 border-l-4 rounded-r",style:{borderColor:"#FF8C42"},children:e.jsx("p",{className:"text-sm",style:{color:"#3C3C3C"},children:"⚠️ Admin can reset the password of team members"})})})]})})]})})}export{ie as EditTeamMemberPage};
