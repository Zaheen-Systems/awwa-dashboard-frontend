import{c as ze,r as u,u as se,j as e,D as U,a as W,b as Y,d as J,e as X,L as y,I as A,T as ue,S as V,f as H,g as K,h as Q,i as M,B as N,k as L,l as E,m as R,n as w,o as C,p as P,q as r,s as we,t as Ve,v as ye}from"./index-DBWuzrFm.js";import{C as T}from"./checkbox-C3y3cPLW.js";import{f as je}from"./dateUtils-Vtm-aUAp.js";import{A as be}from"./arrow-left-B8XO_xiv.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=ze("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);function He({isOpen:a,onClose:j,onSubmit:F,iepGoals:b,studentId:B}){const v=localStorage.getItem("name"),[h,x]=u.useState({date:"",action:"",trigger:"",source:"",time:"",staff:v||"",gcoClassification:"",iep_goal_id:""}),[k,I]=u.useState(null);u.useEffect(()=>{if(a){const o=localStorage.getItem("name");x({date:"",action:"",trigger:"",source:"",time:"",staff:o||"",gcoClassification:"",iep_goal_id:""})}},[a]);const p=async()=>(await L.get(`/api/students/${B}/gcos`)).data,{data:_}=se({queryKey:["gcoIds"],queryFn:p}),g=(o,t)=>{x(f=>({...f,[o]:t}))},G=()=>{if(!h.gcoClassification.trim()){I("GCO classification is required.");return}I(null);const o={...h,iepGoal:h.iep_goal_id==="blank"?"":h.iep_goal_id};console.log(o),F(o),j()},i=()=>{j()};return e.jsx(U,{open:a,onOpenChange:j,children:e.jsxs(W,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",style:{backgroundColor:"white"},children:[e.jsxs(Y,{children:[e.jsx(J,{style:{color:"#3C3C3C"},children:"Add New Behavior Descriptor"}),e.jsx(X,{style:{color:"#6C757D"},children:"Fill in the details for the new behavior descriptor entry."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"date",style:{color:"#3C3C3C"},children:"Date"}),e.jsx(A,{id:"date",type:"date",value:h.date,onChange:o=>g("date",o.target.value),className:"bg-white border-2 focus:outline-none",style:{borderColor:"#BDC3C7",color:"#3C3C3C"},onFocus:o=>o.target.style.borderColor="#e65039",onBlur:o=>o.target.style.borderColor="#BDC3C7"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"action",style:{color:"#3C3C3C"},children:"Action"}),e.jsx(ue,{id:"action",value:h.action,onChange:o=>g("action",o.target.value),className:"bg-white border-2 focus:outline-none min-h-[60px] resize-none",style:{borderColor:"#BDC3C7",color:"#3C3C3C"},onFocus:o=>o.target.style.borderColor="#e65039",onBlur:o=>o.target.style.borderColor="#BDC3C7",placeholder:"Describe the action observed..."})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"trigger",style:{color:"#3C3C3C"},children:"Trigger"}),e.jsx(ue,{id:"trigger",value:h.trigger,onChange:o=>g("trigger",o.target.value),className:"bg-white border-2 focus:outline-none min-h-[60px] resize-none",style:{borderColor:"#BDC3C7",color:"#3C3C3C"},onFocus:o=>o.target.style.borderColor="#e65039",onBlur:o=>o.target.style.borderColor="#BDC3C7",placeholder:"What triggered this behavior..."})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"source",style:{color:"#3C3C3C"},children:"Source"}),e.jsx(A,{id:"source",value:h.source,onChange:o=>g("source",o.target.value),className:"bg-white border-2 focus:outline-none",style:{borderColor:"#BDC3C7",color:"#3C3C3C"},onFocus:o=>o.target.style.borderColor="#e65039",onBlur:o=>o.target.style.borderColor="#BDC3C7",placeholder:"e.g., Snack time, Free play..."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"time",style:{color:"#3C3C3C"},children:"Time"}),e.jsx(A,{id:"time",type:"time",value:h.time,onChange:o=>g("time",o.target.value),className:"bg-white border-2 focus:outline-none",style:{borderColor:"#BDC3C7",color:"#3C3C3C"},onFocus:o=>o.target.style.borderColor="#e65039",onBlur:o=>o.target.style.borderColor="#BDC3C7"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#6C757D"},children:"Not mandatory"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"staff",style:{color:"#3C3C3C"},children:"Staff"}),e.jsx(A,{id:"staff",value:h.staff,onChange:o=>g("staff",o.target.value),className:"bg-white border-2 focus:outline-none",style:{borderColor:"#BDC3C7",color:"#3C3C3C"},onFocus:o=>o.target.style.borderColor="#e65039",onBlur:o=>o.target.style.borderColor="#BDC3C7",readOnly:!0}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#6C757D"},children:"Prefilled with name"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"gcoClassification",style:{color:"#3C3C3C"},children:"GCO classification"}),e.jsxs(V,{value:h.gcoClassification,onValueChange:o=>g("gcoClassification",o),children:[e.jsx(H,{className:"bg-white border-2",style:{borderColor:"#BDC3C7"},children:e.jsx(K,{placeholder:"Drop down with all GCOs"})}),e.jsx(Q,{className:"bg-white border border-gray-200 shadow-lg rounded-md max-h-60 overflow-y-auto",style:{backgroundColor:"white",borderColor:"#BDC3C7",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},position:"popper",side:"bottom",align:"start",children:_==null?void 0:_.map((o,t)=>e.jsx(M,{value:o,className:"hover:bg-gray-100 focus:bg-gray-100",style:{color:"#3C3C3C"},children:o},t))})]}),k&&e.jsx("p",{className:"text-sm mt-1 text-red-500",children:k})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"iepGoal",style:{color:"#3C3C3C"},children:"IEP Goals"}),e.jsxs(V,{value:h.iep_goal_id,onValueChange:o=>g("iep_goal_id",o),children:[e.jsx(H,{className:"bg-white border-2",style:{borderColor:"#BDC3C7"},children:e.jsx(K,{placeholder:"Drop down with all IEP goals, include blank"})}),e.jsx(Q,{className:"bg-white border border-gray-200 shadow-lg rounded-md",style:{backgroundColor:"white",borderColor:"#BDC3C7",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},position:"popper",side:"bottom",align:"start",children:b==null?void 0:b.map((o,t)=>e.jsx(M,{value:o.id.toString(),className:"hover:bg-gray-100 focus:bg-gray-100",style:{color:"#3C3C3C"},children:o.description},t))})]})]})]})]}),e.jsxs("div",{className:"flex justify-center space-x-4 pt-4",children:[e.jsx(N,{onClick:i,className:"px-8 py-2 font-medium border-2 transition-all duration-200 hover:opacity-90",style:{backgroundColor:"white",borderColor:"#BDC3C7",color:"#3C3C3C"},children:"Cancel"}),e.jsx(N,{onClick:G,className:"px-8 py-2 font-medium transition-all duration-200 hover:opacity-90",style:{backgroundColor:"#e65039",color:"white",borderColor:"#e65039"},children:"Submit"})]})]})})}function Ke({isOpen:a,onClose:j,onGenerate:F,behaviourDescriptors:b,iepBehaviourDescriptors:B}){const[v,h]=u.useState([]),[x,k]=u.useState([]);u.useEffect(()=>{if(a){const t=b.filter(d=>d.selected),f=B.filter(d=>d.selected);if(t.length>0||f.length>0){const d=[...t,...f];F(d),j();return}h([]),k([])}},[a,b,B,F,j]);const I=(t,f)=>{h(f?d=>[...d,t]:d=>d.filter(S=>S.id!==t.id))},p=(t,f)=>{k(f?d=>[...d,t]:d=>d.filter(S=>S.id!==t.id))},_=t=>v.some(f=>f.id===t.id),g=t=>x.some(f=>f.id===t.id),G=()=>{const t=[...v,...x];F(t),j()},i=()=>{j()},o=v.length+x.length;return e.jsx(U,{open:a,onOpenChange:j,children:e.jsxs(W,{className:"max-w-[98vw] w-full max-h-[95vh] overflow-y-auto sm:max-w-[90vw] md:max-w-[85vw] lg:max-w-[80vw] xl:max-w-[75vw]",style:{backgroundColor:"white"},children:[e.jsxs(Y,{children:[e.jsx(J,{style:{color:"#3C3C3C"},children:"Select BDs to Export"}),e.jsx(X,{style:{color:"#6C757D"},children:"Choose which behavior descriptors to include in your report."})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium mb-4",style:{color:"#3C3C3C"},children:["Behaviour descriptors for GCO (",v.length," selected)"]}),e.jsx("div",{className:"bg-white rounded-lg border overflow-hidden",style:{borderColor:"#BDC3C7"},children:e.jsx("div",{className:"overflow-x-auto min-w-full",children:e.jsxs(E,{className:"w-full",children:[e.jsx(R,{children:e.jsxs(w,{className:"border-b-2",style:{borderColor:"#BDC3C7",backgroundColor:"#F8F9FA"},children:[e.jsx(C,{className:"w-16 min-w-16",style:{color:"#3C3C3C"},children:"Select"}),e.jsx(C,{className:"w-24 min-w-24",style:{color:"#3C3C3C"},children:"Date"}),e.jsx(C,{className:"w-20 min-w-20",style:{color:"#3C3C3C"},children:"Time"}),e.jsx(C,{className:"w-32 min-w-32",style:{color:"#3C3C3C"},children:"Source"}),e.jsx(C,{className:"w-64 min-w-64",style:{color:"#3C3C3C"},children:"Action"}),e.jsx(C,{className:"w-64 min-w-64",style:{color:"#3C3C3C"},children:"Trigger"}),e.jsx(C,{className:"w-48 min-w-48",style:{color:"#3C3C3C"},children:"Context"}),e.jsx(C,{className:"w-20 min-w-20",style:{color:"#3C3C3C"},children:"GCO"})]})}),e.jsx(P,{children:b.map((t,f)=>{const d=_(t);return e.jsxs(w,{className:f<b.length-1?"border-b":"",style:{borderColor:"#BDC3C7",backgroundColor:d?"#4EAAC9":"transparent"},children:[e.jsx(r,{className:"text-center",children:e.jsx(T,{checked:d,onCheckedChange:S=>I(t,S),className:"border-2",style:{borderColor:d?"#e65039":"#BDC3C7",backgroundColor:d?"#e65039":"transparent"}})}),e.jsx(r,{style:{color:d?"white":"#3C3C3C"},children:t.date}),e.jsx(r,{style:{color:d?"white":"#3C3C3C"},children:t.time}),e.jsx(r,{style:{color:d?"white":"#3C3C3C"},children:t.source}),e.jsx(r,{style:{color:d?"white":"#3C3C3C"},className:"max-w-64 truncate",children:e.jsx("div",{title:t.action,children:t.action})}),e.jsx(r,{style:{color:d?"white":"#3C3C3C"},className:"max-w-64 truncate",children:e.jsx("div",{title:t.trigger,children:t.trigger})}),e.jsx(r,{style:{color:d?"white":"#3C3C3C"},className:"max-w-48 truncate",children:e.jsx("div",{title:t.context,children:t.context})}),e.jsx(r,{style:{color:d?"white":"#3C3C3C"},children:t.gco_classification})]},t.id)})})]})})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium mb-4",style:{color:"#3C3C3C"},children:["Behaviour descriptors for IEP (",x.length," selected)"]}),e.jsx("div",{className:"bg-white rounded-lg border overflow-hidden",style:{borderColor:"#BDC3C7"},children:e.jsx("div",{className:"overflow-x-auto min-w-full",children:e.jsxs(E,{className:"w-full",children:[e.jsx(R,{children:e.jsxs(w,{className:"border-b-2",style:{borderColor:"#BDC3C7",backgroundColor:"#F8F9FA"},children:[e.jsx(C,{className:"w-16 min-w-16",style:{color:"#3C3C3C"},children:"Select"}),e.jsx(C,{className:"w-24 min-w-24",style:{color:"#3C3C3C"},children:"Date"}),e.jsx(C,{className:"w-20 min-w-20",style:{color:"#3C3C3C"},children:"Time"}),e.jsx(C,{className:"w-32 min-w-32",style:{color:"#3C3C3C"},children:"Source"}),e.jsx(C,{className:"w-56 min-w-56",style:{color:"#3C3C3C"},children:"Action"}),e.jsx(C,{className:"w-56 min-w-56",style:{color:"#3C3C3C"},children:"Trigger"}),e.jsx(C,{className:"w-40 min-w-40",style:{color:"#3C3C3C"},children:"Context"}),e.jsx(C,{className:"w-32 min-w-32",style:{color:"#3C3C3C"},children:"IEP Goal"}),e.jsx(C,{className:"w-20 min-w-20",style:{color:"#3C3C3C"},children:"GCO"})]})}),e.jsx(P,{children:B.map((t,f)=>{var S;const d=g(t);return e.jsxs(w,{className:f<B.length-1?"border-b":"",style:{borderColor:"#BDC3C7",backgroundColor:d?"#e65039":"transparent"},children:[e.jsx(r,{className:"text-center",children:e.jsx(T,{checked:d,onCheckedChange:q=>p(t,q),className:"border-2",style:{borderColor:d?"#e65039":"#BDC3C7",backgroundColor:d?"#e65039":"transparent"}})}),e.jsx(r,{style:{color:d?"white":"#3C3C3C"},children:t.date}),e.jsx(r,{style:{color:d?"white":"#3C3C3C"},children:t.time}),e.jsx(r,{style:{color:d?"white":"#3C3C3C"},children:t.source}),e.jsx(r,{style:{color:d?"white":"#3C3C3C"},className:"max-w-56 truncate",children:e.jsx("div",{title:t.action,children:t.action})}),e.jsx(r,{style:{color:d?"white":"#3C3C3C"},className:"max-w-56 truncate",children:e.jsx("div",{title:t.trigger,children:t.trigger})}),e.jsx(r,{style:{color:d?"white":"#3C3C3C"},className:"max-w-40 truncate",children:e.jsx("div",{title:t.context,children:t.context})}),e.jsx(r,{style:{color:d?"white":"#3C3C3C"},children:(S=t.iepGoal)==null?void 0:S.description}),e.jsx(r,{style:{color:d?"white":"#3C3C3C"},children:t==null?void 0:t.gco_classification})]},t.id)})})]})})})]})]}),e.jsxs("div",{className:"flex justify-center space-x-4 pt-4",children:[e.jsx(N,{onClick:i,className:"px-8 py-2 font-medium border-2 transition-all duration-200 hover:opacity-90",style:{backgroundColor:"white",borderColor:"#BDC3C7",color:"#3C3C3C"},children:"Cancel"}),e.jsxs(N,{onClick:G,disabled:o===0,className:"px-8 py-2 font-medium transition-all duration-200 hover:opacity-90 disabled:opacity-50",style:{backgroundColor:o>0?"#e65039":"#BDC3C7",color:"white",borderColor:o>0?"#e65039":"#BDC3C7"},children:["Generate (",o," selected)"]})]})]})})}const le={trigger:"",source:"all",context:"",startDate:"",endDate:"",gcoClassification:"all",hasAction:!1,hasTrigger:!1};function fe({isOpen:a,onClose:j,onApplyFilters:F,onClearFilters:b,behaviorDescriptors:B,title:v}){const[h,x]=u.useState(le),k=Array.from(new Set(B.map(i=>i.source).filter(Boolean))),I=Array.from(new Set(B.map(i=>i.gco_classification).filter(Boolean))),p=(i,o)=>{x(t=>({...t,[i]:o}))},_=()=>{F(h),j()},g=()=>{x(le),b(),j()},G=()=>{x(le),j()};return e.jsx(U,{open:a,onOpenChange:G,children:e.jsxs(W,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",style:{backgroundColor:"white",zIndex:9999},children:[e.jsxs(Y,{children:[e.jsxs(J,{className:"text-lg font-semibold",style:{color:"#3C3C3C"},children:["Filter ",v]}),e.jsx(X,{style:{color:"#6C757D"},children:"Use the filters below to narrow down the behavior descriptors based on your criteria."})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"source-filter",className:"text-sm font-medium",style:{color:"#3C3C3C"},children:"Source"}),e.jsxs(V,{value:h.source,onValueChange:i=>p("source",i),children:[e.jsx(H,{className:"mt-1",children:e.jsx(K,{placeholder:"Select source"})}),e.jsxs(Q,{className:"z-[10000] bg-white border border-gray-200 shadow-lg",children:[e.jsx(M,{value:"all",className:"hover:bg-gray-100 focus:bg-gray-100",children:"All Sources"}),k.map(i=>e.jsx(M,{value:i,className:"hover:bg-gray-100 focus:bg-gray-100",children:i},i))]})]})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"trigger-filter",className:"text-sm font-medium",style:{color:"#3C3C3C"},children:"Trigger"}),e.jsx(A,{id:"trigger-filter",type:"text",placeholder:"Filter by trigger...",value:h.trigger,onChange:i=>p("trigger",i.target.value),className:"mt-1"}),e.jsx("p",{className:"text-xs mt-1",style:{color:"#6C757D"},children:'Example: "during playtime", "when asked to clean up", "at meal time"'})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"context-filter",className:"text-sm font-medium",style:{color:"#3C3C3C"},children:"Context"}),e.jsx(A,{id:"context-filter",type:"text",placeholder:"Filter by context...",value:h.context,onChange:i=>p("context",i.target.value),className:"mt-1"}),e.jsx("p",{className:"text-xs mt-1",style:{color:"#6C757D"},children:'Example: "During free play", "In the classroom", "At circle time", "During transitions"'})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"gco-filter",className:"text-sm font-medium",style:{color:"#3C3C3C"},children:"GCO Classification"}),e.jsxs(V,{value:h.gcoClassification,onValueChange:i=>p("gcoClassification",i),children:[e.jsx(H,{className:"mt-1",children:e.jsx(K,{placeholder:"Select GCO"})}),e.jsxs(Q,{className:"z-[10000] bg-white border border-gray-200 shadow-lg",children:[e.jsx(M,{value:"all",className:"hover:bg-gray-100 focus:bg-gray-100",children:"All GCOs"}),I.map(i=>e.jsxs(M,{value:i,className:"hover:bg-gray-100 focus:bg-gray-100",children:["GCO ",i]},i))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"start-date-filter",className:"text-sm font-medium",style:{color:"#3C3C3C"},children:"Start Date"}),e.jsx(A,{id:"start-date-filter",type:"date",value:h.startDate,onChange:i=>p("startDate",i.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"end-date-filter",className:"text-sm font-medium",style:{color:"#3C3C3C"},children:"End Date"}),e.jsx(A,{id:"end-date-filter",type:"date",value:h.endDate,onChange:i=>p("endDate",i.target.value),className:"mt-1"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{className:"text-sm font-medium",style:{color:"#3C3C3C"},children:"Additional Filters"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"has-action",checked:h.hasAction,onCheckedChange:i=>p("hasAction",i)}),e.jsx(y,{htmlFor:"has-action",className:"text-sm",style:{color:"#3C3C3C"},children:"Only show entries with actions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"has-trigger",checked:h.hasTrigger,onCheckedChange:i=>p("hasTrigger",i)}),e.jsx(y,{htmlFor:"has-trigger",className:"text-sm",style:{color:"#3C3C3C"},children:"Only show entries with triggers"})]})]})]})]}),e.jsxs(we,{className:"flex justify-between",children:[e.jsx(N,{variant:"outline",onClick:g,className:"px-6",style:{borderColor:"#BDC3C7",color:"#3C3C3C"},children:"Clear All"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(N,{variant:"outline",onClick:G,className:"px-6",style:{borderColor:"#BDC3C7",color:"#3C3C3C"},children:"Cancel"}),e.jsx(N,{onClick:_,className:"px-6",style:{backgroundColor:"#e65039",color:"white",borderColor:"#e65039"},children:"Apply Filters"})]})]})]})})}function Qe(a){return se({queryKey:["behavioralDescriptors",a],queryFn:async()=>{const{data:j}=await L.get(`/api/students/${a}/behavioral_descriptors`);return j.map(F=>{const b=new Date(F.created_at);return{...F,selected:!1,date:je(b,"dd.MM.yy"),time:je(b,"h:mm a")}})}})}const Ue=async a=>{const{data:j}=await L.get(`/api/behavioral-descriptors/grouped_gcos/${a}`);return j};function Ze({student:a,onBack:j,onBehaviorDescriptorClick:F}){var ge;const[b,B]=u.useState(""),[v,h]=u.useState(""),[x,k]=u.useState(!1),[I,p]=u.useState(!1),_=Ve(),[g,G]=u.useState([]),[i,o]=u.useState([]),{data:t}=Qe(parseInt(a.id)),[f,d]=u.useState({trigger:"",source:"all",context:"",startDate:"",endDate:"",gcoClassification:"all",hasAction:!1,hasTrigger:!1}),[S,q]=u.useState({trigger:"",source:"all",context:"",startDate:"",endDate:"",gcoClassification:"all",hasAction:!1,hasTrigger:!1}),pe=l=>{if(!b&&!v)return l;console.log("descriptors:",l);const s=n=>{const[c,m,D]=n.split("."),$=`20${D}`;return new Date(`${$}-${m}-${c}`)};return l.filter(n=>{const c=s(n.date),m=b?new Date(b):null,D=v?new Date(v):null;if(x){if(m&&D)return c>=m&&c<=D;if(m)return c>=m;if(D)return c<=D}else if(m&&!D){const $=c.toISOString().split("T")[0],ee=m.toISOString().split("T")[0];return $===ee}else if(m&&D)return c>=m&&c<=D;return!0})};u.useEffect(()=>{if(t){const l=pe(t);console.log("Filtered by date:",l);const s=ie(l.filter(c=>!c.iep_goal),f);G(s);const n=ie(l.filter(c=>!!c.iep_goal),S);o(n)}},[t,b,v,x,f,S]);const{data:O}=se({queryKey:["groupedDescriptors",a.id],queryFn:()=>Ue(parseInt(a.id)),enabled:!!a.id}),[Ne,re]=u.useState(!1),[ve,De]=u.useState(!1),[Fe,oe]=u.useState(!1),[Be,te]=u.useState(!1),ae=(l,s)=>{console.log(l,s),G(n=>n.map(c=>c.id===l?{...c,selected:s}:c))},ce=(l,s)=>{console.log(l,s),o(n=>n.map(c=>c.id===l?{...c,selected:s}:c))},ne=(l,s)=>{s.target.closest('input[type="checkbox"]')||s.target.closest('[role="checkbox"]')||F(l)},ke=()=>{re(!0)},Se=async l=>{const s={source:l.source,action:l.action,trigger:l.trigger,timestamp:l.time,gco_classification:l.gcoClassification,iep_goal_id:Number(l.iep_goal_id),student_id:a.id};return(await L.post("/api/behavioral-descriptors/",s)).data},Ae=()=>ye({mutationFn:Se}),{mutate:_e}=Ae(),Ge=l=>{console.log("Team Member BD submitted:",l),_e(l,{onSuccess:s=>{console.log("BD saved:",s),_.invalidateQueries({queryKey:["behavioralDescriptors",parseInt(a.id)]})},onError:s=>{console.error("Error saving BD:",s)}})},Oe=()=>{B(""),h(""),k(!1)},ie=(l,s)=>l.filter(n=>{if(s.trigger&&!n.trigger.toLowerCase().includes(s.trigger.toLowerCase())||s.source&&s.source!=="all"&&n.source!==s.source||s.context&&!n.context.toLowerCase().includes(s.context.toLowerCase())||s.gcoClassification&&s.gcoClassification!=="all"&&n.gco_classification!==s.gcoClassification)return!1;if(s.startDate||s.endDate){const c=new Date(n.created_at),m=s.startDate?new Date(s.startDate):null,D=s.endDate?new Date(s.endDate):null;if(m&&c<m||D&&c>D)return!1}return!(s.hasAction&&(!n.action||n.action.trim()==="")||s.hasTrigger&&(!n.trigger||n.trigger.trim()===""))}),Ie=l=>{d(l)},Te=()=>{d({trigger:"",source:"all",context:"",startDate:"",endDate:"",gcoClassification:"all",hasAction:!1,hasTrigger:!1})},Ee=l=>{q(l)},Pe=()=>{q({trigger:"",source:"all",context:"",startDate:"",endDate:"",gcoClassification:"all",hasAction:!1,hasTrigger:!1})};console.log(g.filter(l=>l.selected));const $e=()=>{const l=g.filter(c=>c.selected).map(c=>c.id),s=i.filter(c=>c.selected).map(c=>c.id),n=[...l,...s];if(n.length===0){p(!0);return}Re({studentId:a.id,ids:n})};function Me(){return ye({mutationFn:async({studentId:l,ids:s})=>{const n=s&&s.length>0?`?${s.map(m=>`ids=${m}`).join("&")}`:"";return(await L.get(`/api/students/${l}/gcowmr${n}`)).data},onSuccess:l=>{const{download_url:s}=l;if(!s)return;const n=document.createElement("a");n.href=s,n.setAttribute("download","report.xlsx"),document.body.appendChild(n),n.click(),n.remove()}})}const{mutate:Re,isPending:de}=Me(),Le=l=>{console.log(l)},qe=l=>{const s=(l||"").split(".").filter(Boolean);return s.length===0?"":s.length===1?`${s[0]}.0`:`${s[0]}.${s[1]}`},Z=l=>{if(!Array.isArray(l))return[];const s=new Map;for(const n of l){if(!n)continue;const c=qe(n);s.set(c,(s.get(c)||0)+1)}return Array.from(s.entries()).sort((n,c)=>{const[m,D]=n[0].split(".").map(Number),[$,ee]=c[0].split(".").map(Number);return m!==$?m-$:D-ee})},Ce=Z(O==null?void 0:O.gco1),he=Z(O==null?void 0:O.gco2),me=Z(O==null?void 0:O.gco3),xe=Math.max(Ce.length,he.length,me.length);return e.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"#F8F9FA"},children:[e.jsx("div",{className:"px-4 sm:px-6 py-4 sm:py-6 lg:py-8",style:{backgroundColor:"#fff5f3"},children:e.jsx("div",{className:"max-w-7xl mx-auto"})}),e.jsx("div",{className:"px-4 sm:px-6 py-2",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"w-4 h-4",style:{color:"#e65039"}}),e.jsxs("span",{style:{color:"#e65039"},children:["Home > ",a==null?void 0:a.name]})]}),e.jsxs(N,{onClick:j,className:"flex items-center space-x-2 px-6 py-2 font-medium transition-all duration-200 hover:opacity-90",style:{backgroundColor:"#e65039",color:"white",borderColor:"#e65039"},children:[e.jsx(be,{className:"w-5 h-5"}),e.jsx("span",{children:"Back"})]})]})})}),e.jsx("div",{className:"px-4 sm:px-6 pb-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden mb-6",children:e.jsx(E,{children:e.jsxs(P,{children:[e.jsxs(w,{className:"border-b",style:{borderColor:"#BDC3C7"},children:[e.jsx(r,{className:"font-medium",style:{color:"#3C3C3C",backgroundColor:"#F8F9FA"},children:"Name"}),e.jsx(r,{style:{color:"#3C3C3C"},children:a==null?void 0:a.name}),e.jsx(r,{className:"font-medium",style:{color:"#3C3C3C",backgroundColor:"#F8F9FA"},children:"Chronological age (months)"}),e.jsx(r,{style:{color:"#3C3C3C"},children:a==null?void 0:a.chronological_age})]}),e.jsxs(w,{className:"border-b",style:{borderColor:"#BDC3C7"},children:[e.jsx(r,{className:"font-medium",style:{color:"#3C3C3C",backgroundColor:"#F8F9FA"},children:"Primary Diagnosis"}),e.jsx(r,{style:{color:"#3C3C3C"},children:a==null?void 0:a.primary_diagnosis}),e.jsx(r,{className:"font-medium",style:{color:"#3C3C3C",backgroundColor:"#F8F9FA"},children:"Age band (months)"}),e.jsx(r,{style:{color:"#3C3C3C"},children:a==null?void 0:a.age_band})]}),e.jsxs(w,{className:"border-b",style:{borderColor:"#BDC3C7"},children:[e.jsx(r,{className:"font-medium",style:{color:"#3C3C3C",backgroundColor:"#F8F9FA"},children:"Secondary Diagnosis"}),e.jsx(r,{style:{color:"#3C3C3C"},children:a==null?void 0:a.secondary_diagnosis}),e.jsx(r,{className:"font-medium",style:{color:"#3C3C3C",backgroundColor:"#F8F9FA"},children:"Functional Age"}),e.jsx(r,{style:{color:"#3C3C3C"}})]}),e.jsxs(w,{className:"border-b",style:{borderColor:"#BDC3C7"},children:[e.jsx(r,{className:"font-medium",style:{color:"#3C3C3C",backgroundColor:"#F8F9FA"},children:"Entry/Review/Exit"}),e.jsx(r,{style:{color:"#3C3C3C"},children:a==null?void 0:a.entry_type}),e.jsx(r,{className:"font-medium",style:{color:"#3C3C3C",backgroundColor:"#F8F9FA"},children:"GCO 1"}),e.jsx(r,{style:{color:"#3C3C3C"},children:a.gco_1_functional_age})]}),e.jsxs(w,{className:"border-b",style:{borderColor:"#BDC3C7"},children:[e.jsx(r,{className:"font-medium",style:{color:"#3C3C3C",backgroundColor:"#F8F9FA"},children:"CT"}),e.jsx(r,{style:{color:"#3C3C3C"},children:(ge=a.ct)==null?void 0:ge.first_name}),e.jsx(r,{className:"font-medium",style:{color:"#3C3C3C",backgroundColor:"#F8F9FA"},children:"GCO 2"}),e.jsx(r,{style:{color:"#3C3C3C"},children:a.gco_2_functional_age})]}),e.jsxs(w,{children:[e.jsx(r,{className:"font-medium",style:{color:"#3C3C3C",backgroundColor:"#F8F9FA"},children:"Last GCO"}),e.jsx(r,{style:{color:"#3C3C3C"},children:a==null?void 0:a.last_gco_date}),e.jsx(r,{className:"font-medium",style:{color:"#3C3C3C",backgroundColor:"#F8F9FA"},children:"GCO 3"}),e.jsx(r,{style:{color:"#3C3C3C"},children:a.gco_3_functional_age})]})]})})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden mb-6",children:[e.jsx("div",{className:"p-4 border-b",style:{borderColor:"#BDC3C7",backgroundColor:"#F8F9FA"},children:e.jsx("h3",{className:"font-medium",style:{color:"#3C3C3C"},children:"IEP Goals"})}),e.jsx(E,{children:e.jsx(P,{children:a.iep_goals.map((l,s)=>e.jsxs(w,{className:s<a.iep_goals.length-1?"border-b":"",style:{borderColor:"#BDC3C7"},children:[e.jsxs(r,{style:{color:"#3C3C3C"},children:[s+1,"."]}),e.jsx(r,{style:{color:"#3C3C3C"},children:l.description}),e.jsxs(r,{style:{color:"#3C3C3C",backgroundColor:"#F8F9FA"},children:["GCO ",l.gco_number]})]},l.id))})})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(y,{className:"text-sm font-medium",style:{color:"#3C3C3C"},children:"Date Filter Mode:"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(N,{type:"button",variant:x?"outline":"default",size:"sm",onClick:()=>{k(!1),h("")},className:"text-xs",style:{backgroundColor:x?"transparent":"#e65039",color:x?"#3C3C3C":"white",borderColor:"#e65039"},children:"Single Date"}),e.jsx(N,{type:"button",variant:x?"default":"outline",size:"sm",onClick:()=>k(!0),className:"text-xs",style:{backgroundColor:x?"#e65039":"transparent",color:x?"white":"#3C3C3C",borderColor:"#e65039"},children:"Date Range"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(y,{htmlFor:"startDate",style:{color:"#3C3C3C"},children:x?"Start Date":"Date"}),e.jsx(A,{id:"startDate",type:"date",value:b,onChange:l=>B(l.target.value),className:"bg-white border-2 focus:outline-none",style:{borderColor:"#BDC3C7",color:"#3C3C3C"},onFocus:l=>l.target.style.borderColor="#2C5F7C",onBlur:l=>l.target.style.borderColor="#BDC3C7"})]}),x&&e.jsxs("div",{className:"flex-1",children:[e.jsx(y,{htmlFor:"endDate",style:{color:"#3C3C3C"},children:"End Date"}),e.jsx(A,{id:"endDate",type:"date",value:v,onChange:l=>h(l.target.value),className:"bg-white border-2 focus:outline-none",style:{borderColor:"#BDC3C7",color:"#3C3C3C"},onFocus:l=>l.target.style.borderColor="#2C5F7C",onBlur:l=>l.target.style.borderColor="#BDC3C7"})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm",style:{color:"#6C757D"},children:x?"Select a date range to filter behavior descriptors":"Select a specific date to view behavior descriptors for that day"}),e.jsx(N,{type:"button",variant:"outline",size:"sm",onClick:Oe,className:"text-xs",style:{borderColor:"#BDC3C7",color:"#3C3C3C"},children:"Reset Dates"})]})]})})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden mb-6",children:[e.jsx("div",{className:"p-4 border-b",style:{borderColor:"#BDC3C7",backgroundColor:"#F8F9FA"},children:e.jsx("h3",{className:"font-medium",style:{color:"#3C3C3C"},children:"BDs Collected For GCOs"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsxs(E,{children:[e.jsx(R,{className:"sticky top-0 bg-white z-10",children:e.jsxs(w,{className:"border-b-2",style:{borderColor:"#BDC3C7",backgroundColor:"#F8F9FA"},children:[e.jsx(C,{className:"w-12",style:{color:"#3C3C3C"}}),e.jsx(C,{className:"text-center",style:{color:"#3C3C3C"},children:"GCO 1"}),e.jsx(C,{className:"text-center",style:{color:"#3C3C3C"},children:"GCO 2"}),e.jsx(C,{className:"text-center",style:{color:"#3C3C3C"},children:"GCO 3"})]})}),e.jsx(P,{children:Array.from({length:xe}).map((l,s)=>{const n=Ce[s],c=he[s],m=me[s];return e.jsxs(w,{className:s<xe-1?"border-b":"",style:{borderColor:"#BDC3C7"},children:[e.jsx(r,{className:"w-12 text-center text-sm",style:{color:"#3C3C3C",backgroundColor:"transparent"},children:s+1}),e.jsx(r,{className:"text-center",style:{color:"#3C3C3C",backgroundColor:"transparent"},children:n?`${n[0]} (${n[1]})`:""}),e.jsx(r,{className:"text-center",style:{color:"#3C3C3C",backgroundColor:"transparent"},children:c?`${c[0]} (${c[1]})`:""}),e.jsx(r,{className:"text-center",style:{color:"#3C3C3C",backgroundColor:"transparent"},children:m?`${m[0]} (${m[1]})`:""})]},s)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden mb-6",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center",style:{borderColor:"#BDC3C7",backgroundColor:"#F8F9FA"},children:[e.jsx("h3",{className:"font-medium",style:{color:"#3C3C3C"},children:"Behaviour descriptors for GCO"}),e.jsxs(N,{onClick:()=>oe(!0),variant:"outline",size:"sm",className:"flex items-center space-x-2",style:{borderColor:"#BDC3C7",color:"#3C3C3C"},children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{children:"Filter"})]})]}),e.jsx("div",{className:"max-h-[400px] sm:max-h-[500px] lg:max-h-[600px] overflow-y-auto",children:e.jsxs(E,{children:[e.jsx(R,{className:"sticky top-0 bg-white z-10",children:e.jsxs(w,{className:"border-b-2",style:{borderColor:"#BDC3C7",backgroundColor:"#F8F9FA"},children:[e.jsx(C,{className:"w-16 text-center",style:{color:"#3C3C3C"},children:e.jsx(T,{checked:g.length>0&&g.every(l=>l.selected),onCheckedChange:l=>{g.forEach(s=>{ae(s.id,l)})},className:"border-2 data-[state=checked]:bg-primary data-[state=checked]:border-primary",style:{borderColor:"#BDC3C7"}})}),e.jsx(C,{style:{color:"#3C3C3C"},children:"Date"}),e.jsx(C,{style:{color:"#3C3C3C"},children:"Time"}),e.jsx(C,{style:{color:"#3C3C3C"},children:"Source"}),e.jsx(C,{style:{color:"#3C3C3C"},children:"Action"}),e.jsx(C,{style:{color:"#3C3C3C"},children:"Trigger"}),e.jsx(C,{style:{color:"#3C3C3C"},children:"Context"}),e.jsx(C,{style:{color:"#3C3C3C"},children:"GCO"})]})}),e.jsx(P,{children:g==null?void 0:g.filter(l=>l.action&&l.action.trim()!==""&&l.action.toLowerCase()!=="null"&&l.trigger&&l.trigger.trim()!==""&&l.trigger.toLowerCase()!=="null").map((l,s,n)=>e.jsxs(w,{className:`${s<n.length-1?"border-b":""} cursor-pointer hover:bg-gray-50 transition-colors`,style:{borderColor:"#BDC3C7",backgroundColor:l.selected?"#e65039":"transparent"},onClick:c=>ne(l,c),children:[e.jsx(r,{className:"text-center",children:e.jsx(T,{checked:l.selected,onCheckedChange:c=>ae(l.id,c),className:"border-2 data-[state=checked]:bg-primary data-[state=checked]:border-primary",style:{borderColor:l.selected?"#e65039":"#BDC3C7",backgroundColor:l.selected?"#e65039":"transparent"}})}),e.jsx(r,{style:{color:l.selected?"white":"#3C3C3C"},children:l.date}),e.jsx(r,{style:{color:l.selected?"white":"#3C3C3C"},children:l.time}),e.jsx(r,{style:{color:l.selected?"white":"#3C3C3C"},children:l.source}),e.jsx(r,{style:{color:l.selected?"white":"#3C3C3C"},children:l.action}),e.jsx(r,{style:{color:l.selected?"white":"#3C3C3C"},children:l.trigger}),e.jsx(r,{style:{color:l.selected?"white":"#3C3C3C"},children:l.context}),e.jsx(r,{style:{color:l.selected?"white":"#3C3C3C"},children:l.gco_classification})]},l.id))})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden mb-6",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center",style:{borderColor:"#BDC3C7",backgroundColor:"#F8F9FA"},children:[e.jsx("h3",{className:"font-medium",style:{color:"#3C3C3C"},children:"Behaviour descriptors for IEP"}),e.jsxs(N,{onClick:()=>te(!0),variant:"outline",size:"sm",className:"flex items-center space-x-2",style:{borderColor:"#BDC3C7",color:"#3C3C3C"},children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{children:"Filter"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(E,{children:[e.jsx(R,{children:e.jsxs(w,{className:"border-b-2",style:{borderColor:"#BDC3C7",backgroundColor:"#F8F9FA"},children:[e.jsx(C,{className:"w-16 text-center",style:{color:"#3C3C3C"},children:e.jsx(T,{checked:i.length>0&&i.every(l=>l.selected),onCheckedChange:l=>{i.forEach(s=>{ce(s.id,l)})},className:"border-2 data-[state=checked]:bg-primary data-[state=checked]:border-primary",style:{borderColor:"#BDC3C7"}})}),e.jsx(C,{style:{color:"#3C3C3C"},children:"Date"}),e.jsx(C,{style:{color:"#3C3C3C"},children:"Time"}),e.jsx(C,{style:{color:"#3C3C3C"},children:"Source"}),e.jsx(C,{style:{color:"#3C3C3C"},children:"Action"}),e.jsx(C,{style:{color:"#3C3C3C"},children:"Trigger"}),e.jsx(C,{style:{color:"#3C3C3C"},children:"Source"}),e.jsx(C,{style:{color:"#3C3C3C"},children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"IEP Goal"}),e.jsx(z,{className:"w-4 h-4",style:{color:"#6C757D"}})]})}),e.jsx(C,{style:{color:"#3C3C3C"},children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"GCO"}),e.jsx(z,{className:"w-4 h-4",style:{color:"#6C757D"}})]})})]})}),e.jsx(P,{children:i==null?void 0:i.filter(l=>l.action&&l.action.trim()!==""&&l.action.toLowerCase()!=="null"&&l.trigger&&l.trigger.trim()!==""&&l.trigger.toLowerCase()!=="null").map((l,s,n)=>e.jsxs(w,{className:`${s<n.length-1?"border-b":""} cursor-pointer hover:bg-gray-50 transition-colors`,style:{borderColor:"#BDC3C7",backgroundColor:l.selected?"#e65039":"transparent"},onClick:c=>ne(l,c),children:[e.jsx(r,{className:"text-center",children:e.jsx(T,{checked:l.selected,onCheckedChange:c=>ce(l.id,c),className:"border-2 data-[state=checked]:bg-primary data-[state=checked]:border-primary",style:{borderColor:l.selected?"#e65039":"#BDC3C7",backgroundColor:l.selected?"#e65039":"transparent"}})}),e.jsx(r,{style:{color:l.selected?"white":"#3C3C3C"},children:l.date}),e.jsx(r,{style:{color:l.selected?"white":"#3C3C3C"},children:l.time}),e.jsx(r,{style:{color:l.selected?"white":"#3C3C3C"},children:l.source}),e.jsx(r,{style:{color:l.selected?"white":"#3C3C3C"},children:l.action}),e.jsx(r,{style:{color:l.selected?"white":"#3C3C3C"},children:l.trigger}),e.jsx(r,{style:{color:l.selected?"white":"#3C3C3C"},children:l.context}),e.jsx(r,{style:{color:l.selected?"white":"#3C3C3C"},children:l.iep_goal?`Goal ${a.iep_goals.findIndex(c=>{var m;return c.id===((m=l.iep_goal)==null?void 0:m.id)})+1}`:"N/A"}),e.jsxs(r,{style:{color:l.selected?"white":"#3C3C3C"},children:["GCO ",l.gco_classification]})]},l.id))})]})})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsx(N,{onClick:ke,className:"px-6 py-2 font-medium transition-all duration-200 hover:opacity-90",style:{backgroundColor:"#e65039",color:"white",borderColor:"#e65039"},children:"Add New BDs"}),e.jsx(N,{onClick:$e,className:"px-6 py-2 font-medium transition-all duration-200 hover:opacity-90",disabled:de,style:{backgroundColor:"#e65039",color:"white",borderColor:"#e65039"},children:de?"Generating...":"Generate Report"}),e.jsx(U,{open:I,onOpenChange:p,children:e.jsxs(W,{className:"sm:max-w-md rounded-2xl bg-white shadow-lg border border-gray-200 p-6",children:[e.jsxs(Y,{className:"space-y-2",children:[e.jsxs(J,{className:"flex items-center gap-2 text-lg font-semibold text-gray-900",children:[e.jsx("span",{className:"text-yellow-500",children:"⚠️"}),"No Selection"]}),e.jsx(X,{className:"text-gray-600",children:"Please select at least one behaviour descriptor before generating a report."})]}),e.jsx(we,{className:"mt-4",children:e.jsx(N,{onClick:()=>p(!1),className:"bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg px-4",children:"Okay"})})]})})]})]})}),e.jsx(He,{isOpen:Ne,onClose:()=>re(!1),onSubmit:Ge,iepGoals:a.iep_goals,studentId:a.id}),e.jsx(Ke,{isOpen:ve,onClose:()=>De(!1),behaviourDescriptors:g||[],iepBehaviourDescriptors:i||[],onGenerate:Le}),e.jsx(fe,{isOpen:Fe,onClose:()=>oe(!1),onApplyFilters:Ie,onClearFilters:Te,behaviorDescriptors:t||[],title:"GCO Behaviour Descriptors"}),e.jsx(fe,{isOpen:Be,onClose:()=>te(!1),onApplyFilters:Ee,onClearFilters:Pe,behaviorDescriptors:t||[],title:"IEP Behaviour Descriptors"})]})}export{Ze as StudentDetailPage};
